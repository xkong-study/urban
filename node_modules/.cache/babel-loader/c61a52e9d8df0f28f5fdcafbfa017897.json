{"ast":null,"code":"import _slicedToArray from \"/Users/kong/game-cloud-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/Users/kong/game-cloud-frontend/src/pages/Means.jsx\";\nimport React, { useEffect, useState } from 'react';\nimport { Form, Input, Button, message, Upload } from 'antd';\nimport { GetUserDataApi, ChangeUserDataApi } from './request/api';\nimport \"./less/Means.less\";\nimport { LoadingOutlined, PlusOutlined } from '@ant-design/icons';\nimport { connect } from 'react-redux'; // 将图片路径转base64\n\nfunction getBase64(img, callback) {\n  var reader = new FileReader();\n  reader.addEventListener('load', function () {\n    return callback(reader.result);\n  });\n  reader.readAsDataURL(img);\n} // 限制图片大小只能是200KB\n\n\nfunction beforeUpload(file) {\n  var isJpgOrPng = file.type === 'image/jpeg' || file.type === 'image/png';\n\n  if (!isJpgOrPng) {\n    message.error('You can only upload JPG/PNG file!');\n  }\n\n  var isLt2M = file.size / 1024 / 1024 / 1024 < 200;\n\n  if (!isLt2M) {\n    message.error('请上传小于200KB的图!');\n  }\n\n  return isJpgOrPng && isLt2M;\n}\n\nfunction Means(props) {\n  var _useState = useState(false),\n      _useState2 = _slicedToArray(_useState, 2),\n      loading = _useState2[0],\n      setLoading = _useState2[1];\n\n  var _useState3 = useState(\"\"),\n      _useState4 = _slicedToArray(_useState3, 2),\n      imageUrl = _useState4[0],\n      setImageUrl = _useState4[1];\n\n  useEffect(function () {\n    GetUserDataApi().then(function (res) {\n      console.log(res);\n\n      if (res.errCode === 0) {\n        message.success(res.message); // 存到sessionStorage\n\n        sessionStorage.setItem('username', res.data.username);\n      }\n    });\n  }, []); // 表单提交的事件\n\n  var onFinish = function onFinish(values) {\n    // 如果表单的username有值，并且不等于初始化时拿到的username，同时密码非空\n    if (values.username && values.username !== sessionStorage.getItem('username') && values.password.trim() !== \"\") {\n      // 做表单的提交...\n      ChangeUserDataApi({\n        username: values.username,\n        password: values.password\n      }).then(function (res) {\n        console.log(res); // 当你修改成功的时候，不要忘了重新登录\n      });\n    }\n  }; // 点击了上传图片\n\n\n  var handleChange = function handleChange(info) {\n    if (info.file.status === 'uploading') {\n      setLoading(true);\n      return;\n    }\n\n    if (info.file.status === 'done') {\n      // Get this url from response in real world.\n      getBase64(info.file.originFileObj, function (imageUrl) {\n        setLoading(false);\n        setImageUrl(imageUrl); // 存储图片名称\n\n        localStorage.setItem('avatar', info.file.response.data.filePath); // 使用react-redux\n\n        props.addKey();\n      });\n    }\n  }; // 上传按钮\n\n\n  var uploadButton = /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 80,\n      columnNumber: 9\n    }\n  }, loading ? /*#__PURE__*/React.createElement(LoadingOutlined, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 81,\n      columnNumber: 24\n    }\n  }) : /*#__PURE__*/React.createElement(PlusOutlined, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 81,\n      columnNumber: 46\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      marginTop: 8\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 13\n    }\n  }, \"Upload\"));\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"means\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 87,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Form, {\n    name: \"basic\",\n    style: {\n      width: '400px'\n    },\n    onFinish: onFinish,\n    autoComplete: \"off\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Form.Item, {\n    label: \"\\u4FEE\\u6539\\u7528\\u6237\\u540D\\uFF1A\",\n    name: \"username\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(Input, {\n    placeholder: \"\\u8BF7\\u8F93\\u5165\\u65B0\\u7528\\u6237\\u540D\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 95,\n      columnNumber: 21\n    }\n  })), /*#__PURE__*/React.createElement(Form.Item, {\n    label: \"\\u4FEE \\u6539 \\u5BC6 \\u7801\\uFF1A\",\n    name: \"password\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(Input.Password, {\n    placeholder: \"\\u8BF7\\u8F93\\u5165\\u65B0\\u5BC6\\u7801\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 21\n    }\n  })), /*#__PURE__*/React.createElement(Form.Item, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    type: \"primary\",\n    htmlType: \"submit\",\n    style: {\n      float: 'right'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 103,\n      columnNumber: 21\n    }\n  }, \"\\u63D0\\u4EA4\"))), /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 13\n    }\n  }, \"\\u70B9\\u51FB\\u4E0B\\u65B9\\u4FEE\\u6539\\u5934\\u50CF\\uFF1A\"), /*#__PURE__*/React.createElement(Upload, {\n    name: \"avatar\",\n    listType: \"picture-card\",\n    className: \"avatar-uploader\",\n    showUploadList: false,\n    action: \"/api/upload\",\n    beforeUpload: beforeUpload,\n    onChange: handleChange,\n    headers: {\n      \"cms-token\": localStorage.getItem('cms-token')\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 107,\n      columnNumber: 13\n    }\n  }, imageUrl ? /*#__PURE__*/React.createElement(\"img\", {\n    src: imageUrl,\n    alt: \"avatar\",\n    style: {\n      width: '100%'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 29\n    }\n  }) : uploadButton));\n}\n\nvar mapDispatchToProps = function mapDispatchToProps(dispatch) {\n  return {\n    addKey: function addKey() {\n      dispatch({\n        type: \"addKeyFn\"\n      });\n    }\n  };\n};\n\nexport default connect(null, mapDispatchToProps)(Means);","map":{"version":3,"sources":["/Users/kong/game-cloud-frontend/src/pages/Means.jsx"],"names":["React","useEffect","useState","Form","Input","Button","message","Upload","GetUserDataApi","ChangeUserDataApi","LoadingOutlined","PlusOutlined","connect","getBase64","img","callback","reader","FileReader","addEventListener","result","readAsDataURL","beforeUpload","file","isJpgOrPng","type","error","isLt2M","size","Means","props","loading","setLoading","imageUrl","setImageUrl","then","res","console","log","errCode","success","sessionStorage","setItem","data","username","onFinish","values","getItem","password","trim","handleChange","info","status","originFileObj","localStorage","response","filePath","addKey","uploadButton","marginTop","width","float","mapDispatchToProps","dispatch"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react'\nimport { Form, Input, Button, message, Upload } from 'antd';\nimport {GetUserDataApi, ChangeUserDataApi} from './request/api'\nimport \"./less/Means.less\"\nimport { LoadingOutlined, PlusOutlined } from '@ant-design/icons';\nimport {connect} from 'react-redux'\n\n// 将图片路径转base64\nfunction getBase64(img, callback) {\n    const reader = new FileReader();\n    reader.addEventListener('load', () => callback(reader.result));\n    reader.readAsDataURL(img);\n}\n\n// 限制图片大小只能是200KB\nfunction beforeUpload(file) {\n    const isJpgOrPng = file.type === 'image/jpeg' || file.type === 'image/png';\n    if (!isJpgOrPng) {\n        message.error('You can only upload JPG/PNG file!');\n    }\n    const isLt2M = file.size / 1024 / 1024 / 1024  < 200;\n    if (!isLt2M) {\n        message.error('请上传小于200KB的图!');\n    }\n    return isJpgOrPng && isLt2M;\n}\n\nfunction Means(props){\n    const [loading, setLoading] = useState(false)\n    const [imageUrl, setImageUrl] = useState(\"\")\n\n    useEffect(()=>{\n        GetUserDataApi().then(res=>{\n            console.log(res)\n            if(res.errCode===0){\n                message.success(res.message)\n                // 存到sessionStorage\n                sessionStorage.setItem('username', res.data.username)\n            }\n        })\n    }, [])\n\n    // 表单提交的事件\n    const onFinish = (values) => {\n        // 如果表单的username有值，并且不等于初始化时拿到的username，同时密码非空\n        if(values.username && values.username!==sessionStorage.getItem('username') && values.password.trim() !== \"\"){\n            // 做表单的提交...\n            ChangeUserDataApi({\n                username: values.username,\n                password: values.password\n            }).then(res=>{\n                console.log(res)\n                // 当你修改成功的时候，不要忘了重新登录\n            })\n        }\n    }\n\n    // 点击了上传图片\n    const handleChange = info => {\n        if (info.file.status === 'uploading') {\n            setLoading(true)\n            return;\n        }\n        if (info.file.status === 'done') {\n            // Get this url from response in real world.\n            getBase64(info.file.originFileObj, imageUrl =>{\n                    setLoading(false)\n                    setImageUrl(imageUrl)\n                    // 存储图片名称\n                    localStorage.setItem('avatar', info.file.response.data.filePath)\n                    // 使用react-redux\n                    props.addKey()\n                }\n            );\n        }\n    };\n\n    // 上传按钮\n    const uploadButton = (\n        <div>\n            {loading ? <LoadingOutlined /> : <PlusOutlined />}\n            <div style={{ marginTop: 8 }}>Upload</div>\n        </div>\n    );\n\n    return (\n        <div className='means'>\n            <Form\n                name=\"basic\"\n                style={{width: '400px'}}\n                onFinish={onFinish}\n                autoComplete=\"off\"\n            >\n                <Form.Item label=\"修改用户名：\" name=\"username\">\n                    <Input placeholder='请输入新用户名' />\n                </Form.Item>\n\n                <Form.Item label=\"修 改 密 码：\" name=\"password\">\n                    <Input.Password placeholder='请输入新密码' />\n                </Form.Item>\n\n                <Form.Item>\n                    <Button type=\"primary\" htmlType=\"submit\" style={{float: 'right'}}>提交</Button>\n                </Form.Item>\n            </Form>\n            <p>点击下方修改头像：</p>\n            <Upload\n                name=\"avatar\"\n                listType=\"picture-card\"\n                className=\"avatar-uploader\"\n                showUploadList={false}\n                action=\"/api/upload\"\n                beforeUpload={beforeUpload}\n                onChange={handleChange}\n                headers={{\"cms-token\": localStorage.getItem('cms-token')}}\n            >\n                {imageUrl ? <img src={imageUrl} alt=\"avatar\" style={{ width: '100%' }} /> : uploadButton}\n            </Upload>\n        </div>\n    )\n}\n\nconst mapDispatchToProps = (dispatch) => {\n    return {\n        addKey(){\n            dispatch({type: \"addKeyFn\"})\n        }\n    }\n}\n\nexport default connect(null, mapDispatchToProps)(Means)"]},"metadata":{},"sourceType":"module"}
{"version":3,"file":"index.esm.js","sources":["../src/components/Editor.tsx","../src/components/Toolbar.tsx"],"sourcesContent":["/**\n * @description editor react component\n * @author wangfupeng\n */\n\nimport React, { useRef, useEffect, useState } from 'react'\nimport {SlateDescendant, IEditorConfig, createEditor, IDomEditor, SlateEditor, SlateTransforms } from '@wangeditor/editor'\n\ninterface IProps {\n  defaultContent?: SlateDescendant[]\n  onCreated?: (editor: IDomEditor) => void\n  defaultHtml?: string\n  value?: string\n  onChange: (editor: IDomEditor) => void\n  defaultConfig: Partial<IEditorConfig>\n  mode?: string\n  style?: React.CSSProperties\n}\n\nfunction EditorComponent(props: Partial<IProps>) {\n  const { defaultContent = [], onCreated, defaultHtml = '', value = '', onChange, defaultConfig = {}, mode = 'default', style = {} } = props\n  const ref = useRef<HTMLDivElement>(null)\n  const [editor, setEditor] = useState<IDomEditor | null>(null)\n  const [curValue, setCurValue] = useState('')\n\n  const handleCreated = (editor: IDomEditor) => {\n    // 组件属性 onCreated\n    if (onCreated) onCreated(editor)\n\n    // 编辑器 配置 onCreated\n    const { onCreated: onCreatedFromConfig } = defaultConfig\n    if (onCreatedFromConfig) onCreatedFromConfig(editor)\n  }\n\n  const handleChanged = (editor: IDomEditor) => {\n    setCurValue(editor.getHtml()) // 记录当前 html 值\n\n    // 组件属性 onChange\n    if (onChange) onChange(editor)\n\n    // 编辑器 配置 onChange\n    const { onChange: onChangeFromConfig } = defaultConfig\n    if (onChangeFromConfig) onChangeFromConfig(editor)\n  }\n\n  const handleDestroyed = (editor: IDomEditor) => {\n    const { onDestroyed } = defaultConfig\n    setEditor(null)\n    if(onDestroyed) {\n      onDestroyed(editor)\n    }\n  }\n\n  // value 变化，重置 HTML\n  useEffect(() => {\n    if (editor == null) return\n\n    if (value === curValue) return // 如果和当前 html 值相等，则忽略\n\n    // ------ 重新设置 HTML ------\n\n    // 记录编辑器当前状态\n    const isEditorDisabled = editor.isDisabled()\n    const isEditorFocused = editor.isFocused()\n    const editorSelectionStr = JSON.stringify(editor.selection)\n\n    // 删除并重新设置 HTML\n    editor.enable()\n    editor.focus()\n    editor.select([])\n    editor.deleteFragment()\n    // @ts-ignore\n    SlateTransforms.setNodes(editor, { type: 'paragraph' }, { mode: 'highest' })\n    editor.dangerouslyInsertHtml(value)\n\n    // 恢复编辑器状态\n    if (!isEditorFocused) {\n      editor.deselect()\n      editor.blur()\n      return\n    }\n    if (isEditorDisabled) {\n      editor.deselect()\n      editor.disable()\n      return\n    }\n    try {\n      editor.select(JSON.parse(editorSelectionStr)) // 选中原来的位置\n    } catch (ex) {\n      editor.select(SlateEditor.start(editor, [])) // 选中开始\n    }\n\n  }, [value])\n\n  useEffect(() => {\n    if (ref.current == null) return\n    if (editor != null) return\n\n    const newEditor = createEditor({\n      selector: ref.current,\n      config: {\n        ...defaultConfig,\n        onCreated: handleCreated,\n        onChange: handleChanged,\n        onDestroyed: handleDestroyed,\n      },\n      content: defaultContent,\n      html: defaultHtml || value,\n      mode,\n    })\n    setEditor(newEditor)\n  }, [editor])\n\n  return <div style={style} ref={ref}></div>\n}\n\nexport default EditorComponent\n","/**\n * @description toolbar react component\n * @author wangfupeng\n */\n\nimport React, { useRef, useEffect } from 'react'\nimport * as wangEditor from '@wangeditor/editor'\n\ninterface IProps {\n  editor: wangEditor.IDomEditor | null\n  defaultConfig?: Partial<wangEditor.IToolbarConfig>\n  mode?: string\n  style?: object\n}\n\nfunction ToolbarComponent(props: IProps) {\n  const { editor, defaultConfig = {}, mode = 'default', style = {} } = props\n  const ref = useRef<HTMLDivElement>(null)\n\n  useEffect(() => {\n    if (ref.current == null) return\n    if (editor == null) return\n\n    wangEditor.createToolbar({\n      editor,\n      selector: ref.current,\n      config: defaultConfig,\n      mode,\n    })\n  }, [editor])\n\n  return <div style={style} ref={ref}></div>\n}\n\nexport default ToolbarComponent\n"],"names":["EditorComponent","props","_a","defaultContent","onCreated","_b","defaultHtml","_c","value","onChange","_d","defaultConfig","_e","mode","_f","style","ref","useRef","_g","__read","useState","editor","setEditor","_h","curValue","setCurValue","handleCreated","onCreatedFromConfig","handleChanged","getHtml","onChangeFromConfig","handleDestroyed","onDestroyed","useEffect","isEditorDisabled","isDisabled","isEditorFocused","isFocused","editorSelectionStr","_JSON$stringify","selection","enable","focus","select","deleteFragment","SlateTransforms","setNodes","type","dangerouslyInsertHtml","deselect","blur","disable","JSON","parse","ex","SlateEditor","start","current","newEditor","createEditor","selector","config","content","html","React","ToolbarComponent","wangEditor","createToolbar"],"mappings":";;;;;;;;;;;;;;6jBAmBA,SAASA,EAAgBC,OACfC,EAA6HD,iBAA7HE,aAAiB,KAAIC,EAAwGH,YAA7FI,EAA6FJ,cAA7FK,aAAc,KAAIC,EAA2EN,QAA3EO,aAAQ,KAAIC,EAA+DR,WAArDS,EAAqDT,gBAArDU,aAAgB,KAAIC,EAAiCX,OAAjCY,aAAO,YAAWC,EAAeb,QAAfc,aAAQ,KACxHC,EAAMC,EAAuB,MAC7BC,EAAAC,EAAsBC,EAA4B,SAAjDC,OAAQC,OACTC,EAAAJ,EAA0BC,EAAS,OAAlCI,OAAUC,OAEXC,EAAgB,SAACL,GAEjBjB,GAAWA,EAAUiB,OAGNM,EAAwBhB,YACvCgB,GAAqBA,EAAoBN,IAGzCO,EAAgB,SAACP,GACrBI,EAAYJ,EAAOQ,WAGfpB,GAAUA,EAASY,OAGLS,EAAuBnB,WACrCmB,GAAoBA,EAAmBT,IAGvCU,EAAkB,SAACV,OACfW,EAAgBrB,cACxBW,EAAU,MACPU,GACDA,EAAYX,WAKhBY,GAAU,cACM,MAAVZ,GAEAb,IAAUgB,OAKRU,EAAmBb,EAAOc,aAC1BC,EAAkBf,EAAOgB,YACzBC,EAAqBC,EAAelB,EAAOmB,cAGjDnB,EAAOoB,SACPpB,EAAOqB,QACPrB,EAAOsB,OAAO,IACdtB,EAAOuB,iBAEPC,EAAgBC,SAASzB,EAAQ,CAAE0B,KAAM,aAAe,CAAElC,KAAM,YAChEQ,EAAO2B,sBAAsBxC,IAGxB4B,SACHf,EAAO4B,gBACP5B,EAAO6B,UAGLhB,SACFb,EAAO4B,gBACP5B,EAAO8B,cAIP9B,EAAOsB,OAAOS,KAAKC,MAAMf,IACzB,MAAOgB,GACPjC,EAAOsB,OAAOY,EAAYC,MAAMnC,EAAQ,SAGzC,CAACb,IAEJyB,GAAU,cACW,MAAfjB,EAAIyC,SACM,MAAVpC,OAEEqC,EAAYC,EAAa,CAC7BC,SAAU5C,EAAIyC,QACdI,cACKlD,IACHP,UAAWsB,EACXjB,SAAUmB,EACVI,YAAaD,IAEf+B,QAAS3D,EACT4D,KAAMzD,GAAeE,EACrBK,SAEFS,EAAUoC,MACT,CAACrC,IAEG2C,uBAAKjD,MAAOA,EAAOC,IAAKA,IClGjC,SAASiD,EAAiBhE,OAChBoB,EAA6DpB,SAArDC,EAAqDD,gBAArDU,aAAgB,KAAIN,EAAiCJ,OAAjCY,aAAO,YAAWN,EAAeN,QAAfc,aAAQ,KACxDC,EAAMC,EAAuB,aAEnCgB,GAAU,WACW,MAAfjB,EAAIyC,SACM,MAAVpC,GAEJ6C,EAAWC,cAAc,CACvB9C,SACAuC,SAAU5C,EAAIyC,QACdI,OAAQlD,EACRE,WAED,CAACQ,IAEG2C,uBAAKjD,MAAOA,EAAOC,IAAKA"}